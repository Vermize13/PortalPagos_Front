<div class="container-fluid p-4">
  <p-card>
    <div class="flex justify-content-between align-items-center mb-4">
      <h2 class="m-0">Gestión de Proyectos</h2>
      <p-button label="Nuevo Proyecto" icon="pi pi-plus" (onClick)="onCreate()"></p-button>
    </div>

    <p-table 
      [value]="projects" 
      [loading]="loading"
      [paginator]="true" 
      [rows]="10"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} proyectos"
      [rowsPerPageOptions]="[10, 25, 50]"
      styleClass="p-datatable-striped">
      
      <ng-template pTemplate="header">
        <tr>
          <th>Código</th>
          <th>Nombre</th>
          <th>Descripción</th>
          <th>Estado</th>
          <th>Fecha Creación</th>
          <th>Acciones</th>
        </tr>
      </ng-template>
      
      <ng-template pTemplate="body" let-project>
        <tr>
          <td>{{ project.code }}</td>
          <td>{{ project.name }}</td>
          <td>{{ project.description }}</td>
          <td>
            <p-tag [value]="project.isActive ? 'Activo' : 'Inactivo'" [severity]="getStatusSeverity(project.isActive)"></p-tag>
          </td>
          <td>{{ project.createdAt | date:'short' }}</td>
          <td>
            <p-button 
              icon="pi pi-eye" 
              [rounded]="true" 
              [text]="true" 
              severity="secondary"
              (onClick)="onViewDetails(project)"></p-button>
            <p-button 
              icon="pi pi-pencil" 
              [rounded]="true" 
              [text]="true" 
              severity="info"
              (onClick)="onEdit(project)"></p-button>
            <p-button 
              icon="pi pi-trash" 
              [rounded]="true" 
              [text]="true" 
              severity="danger"
              (onClick)="onDelete(project)"></p-button>
          </td>
        </tr>
      </ng-template>
      
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="6" class="text-center">No se encontraron proyectos.</td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>

  <!-- Project Create/Edit Dialog -->
  <p-dialog 
    [(visible)]="displayDialog" 
    [header]="isEditMode ? 'Editar Proyecto' : 'Nuevo Proyecto'"
    [modal]="true"
    [style]="{width: '600px'}"
    [closable]="true">
    
    <div class="p-fluid">
      <div class="field mb-3">
        <label for="code">Código *</label>
        <input 
          id="code" 
          type="text" 
          pInputText 
          [(ngModel)]="projectForm.code"
          [disabled]="isEditMode"
          placeholder="Ej: PP, SI"
          maxlength="10" />
        <small class="text-muted">Código único del proyecto (2-10 caracteres)</small>
      </div>

      <div class="field mb-3">
        <label for="name">Nombre *</label>
        <input 
          id="name" 
          type="text" 
          pInputText 
          [(ngModel)]="projectForm.name"
          placeholder="Nombre del proyecto" />
      </div>

      <div class="field mb-3">
        <label for="description">Descripción</label>
        <textarea 
          id="description" 
          pInputTextarea 
          [(ngModel)]="projectForm.description"
          placeholder="Descripción del proyecto"
          rows="4">
        </textarea>
      </div>

      <div class="field mb-3">
        <div class="flex align-items-center">
          <p-checkbox 
            [(ngModel)]="projectForm.isActive"
            [binary]="true"
            inputId="active">
          </p-checkbox>
          <label for="active" class="ml-2">Proyecto Activo</label>
        </div>
      </div>
    </div>

    <ng-template pTemplate="footer">
      <p-button 
        label="Cancelar" 
        icon="pi pi-times" 
        (onClick)="onCancelDialog()"
        styleClass="p-button-text">
      </p-button>
      <p-button 
        [label]="isEditMode ? 'Actualizar' : 'Crear'" 
        icon="pi pi-check" 
        (onClick)="onSaveProject()">
      </p-button>
    </ng-template>
  </p-dialog>

  <!-- Confirmation Dialog -->
  <p-confirmDialog></p-confirmDialog>
</div>
