<div class="container-fluid p-4" *ngIf="project">
  <!-- Header Section -->
  <div class="header-section mb-4">
    <div class="flex align-items-center justify-content-between">
      <div class="flex align-items-center gap-3">
        <p-button 
          icon="pi pi-arrow-left" 
          [rounded]="true" 
          [text]="true"
          severity="secondary"
          (onClick)="onBack()"
          pTooltip="Volver a la lista"
          tooltipPosition="right">
        </p-button>
        <div>
          <div class="flex align-items-center gap-2 mb-2">
            <h1 class="project-title m-0">{{ project.name }}</h1>
            <p-tag 
              [value]="project.isActive ? 'Activo' : 'Inactivo'" 
              [severity]="getStatusSeverity(project.isActive)">
            </p-tag>
          </div>
          <p class="project-code text-muted m-0">Código: {{ project.code }}</p>
        </div>
      </div>
      <p-button 
        label="Editar Proyecto" 
        icon="pi pi-pencil"
        (onClick)="onEdit()">
      </p-button>
    </div>
  </div>

  <!-- Main Content -->
  <div class="grid">
    <!-- Left Column - Project Details -->
    <div class="col-12 lg:col-8">
      <p-tabView>
        <!-- Overview Tab -->
        <p-tabPanel header="Información">
          <p-card styleClass="mb-3">
            <div class="project-details">
              <div class="detail-item">
                <label class="detail-label">Descripción</label>
                <p class="detail-value">{{ project.description || 'Sin descripción' }}</p>
              </div>

              <div class="grid">
                <div class="col-12 md:col-6">
                  <div class="detail-item">
                    <label class="detail-label">Fecha de Creación</label>
                    <p class="detail-value">{{ project.createdAt | date:'medium' }}</p>
                  </div>
                </div>
                <div class="col-12 md:col-6">
                  <div class="detail-item">
                    <label class="detail-label">Última Actualización</label>
                    <p class="detail-value">{{ project.updatedAt | date:'medium' }}</p>
                  </div>
                </div>
              </div>

              <div class="detail-item" *ngIf="project.creator">
                <label class="detail-label">Creado por</label>
                <p class="detail-value">{{ project.creator.name }} ({{ project.creator.email }})</p>
              </div>
            </div>
          </p-card>
        </p-tabPanel>

        <!-- Team Members Tab -->
        <p-tabPanel header="Equipo">
          <p-card>
            <p-table 
              [value]="members"
              [loading]="loading"
              [paginator]="true"
              [rows]="10"
              [showCurrentPageReport]="true"
              currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} miembros"
              styleClass="p-datatable-sm">
              
              <ng-template pTemplate="header">
                <tr>
                  <th>Usuario</th>
                  <th>Email</th>
                  <th>Rol</th>
                  <th>Fecha de Ingreso</th>
                  <th>Estado</th>
                </tr>
              </ng-template>
              
              <ng-template pTemplate="body" let-member>
                <tr>
                  <td>
                    <div class="flex align-items-center gap-2">
                      <p-avatar 
                        [label]="getMemberInitials(member.userName || '')"
                        shape="circle"
                        size="normal"
                        styleClass="avatar-custom">
                      </p-avatar>
                      <span>{{ member.userName }}</span>
                    </div>
                  </td>
                  <td>{{ member.userEmail }}</td>
                  <td>
                    <span class="role-badge">{{ member.roleName }}</span>
                  </td>
                  <td>{{ member.joinedAt | date:'short' }}</td>
                  <td>
                    <p-tag 
                      [value]="member.isActive ? 'Activo' : 'Inactivo'" 
                      [severity]="getStatusSeverity(member.isActive)">
                    </p-tag>
                  </td>
                </tr>
              </ng-template>
              
              <ng-template pTemplate="emptymessage">
                <tr>
                  <td colspan="5" class="text-center">No hay miembros en este proyecto.</td>
                </tr>
              </ng-template>
            </p-table>
          </p-card>
        </p-tabPanel>

        <!-- Sprints Tab -->
        <p-tabPanel header="Sprints">
          <app-sprint-list [projectId]="projectId"></app-sprint-list>
        </p-tabPanel>
      </p-tabView>
    </div>

    <!-- Right Column - Statistics & Activity -->
    <div class="col-12 lg:col-4">
      <p-card styleClass="mb-3">
        <ng-template pTemplate="header">
          <div class="card-header-custom">
            <h3 class="m-0">Estadísticas</h3>
          </div>
        </ng-template>
        
        <div class="stats-container">
          <div class="stat-item">
            <div class="stat-icon stat-icon-primary">
              <i class="pi pi-users"></i>
            </div>
            <div class="stat-info">
              <p class="stat-value">{{ members.length }}</p>
              <p class="stat-label">Miembros</p>
            </div>
          </div>

          <div class="stat-item">
            <div class="stat-icon stat-icon-success">
              <i class="pi pi-check-circle"></i>
            </div>
            <div class="stat-info">
              <p class="stat-value">{{ getActiveMembersCount() }}</p>
              <p class="stat-label">Miembros Activos</p>
            </div>
          </div>

          <div class="stat-item">
            <div class="stat-icon stat-icon-info">
              <i class="pi pi-calendar"></i>
            </div>
            <div class="stat-info">
              <p class="stat-value">{{ getDaysActive() }}</p>
              <p class="stat-label">Días Activo</p>
            </div>
          </div>
        </div>
      </p-card>

      <p-card>
        <ng-template pTemplate="header">
          <div class="card-header-custom">
            <h3 class="m-0">Actividad Reciente</h3>
          </div>
        </ng-template>
        
        <div class="activity-container">
          <div class="activity-item">
            <div class="activity-icon">
              <i class="pi pi-user-plus"></i>
            </div>
            <div class="activity-info">
              <p class="activity-text">Nuevo miembro agregado</p>
              <p class="activity-time">Hace 2 días</p>
            </div>
          </div>

          <div class="activity-item">
            <div class="activity-icon">
              <i class="pi pi-pencil"></i>
            </div>
            <div class="activity-info">
              <p class="activity-text">Proyecto actualizado</p>
              <p class="activity-time">Hace 5 días</p>
            </div>
          </div>

          <div class="activity-item">
            <div class="activity-icon">
              <i class="pi pi-check"></i>
            </div>
            <div class="activity-info">
              <p class="activity-text">Estado cambiado a Activo</p>
              <p class="activity-time">Hace 1 semana</p>
            </div>
          </div>
        </div>
      </p-card>
    </div>
  </div>
</div>

<!-- Loading State -->
<div *ngIf="!project && loading" class="loading-container">
  <p-progressSpinner></p-progressSpinner>
</div>
