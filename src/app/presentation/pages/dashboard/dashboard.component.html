<div class="container-fluid p-4">
  <h1 class="mb-4">Dashboard - Sistema de Gestión de Incidencias</h1>
  
  <!-- RF4: Dashboard Metrics Summary Cards -->
  <div class="grid">
    <div class="col-12 md:col-6 lg:col-3">
      <p-card>
        <div class="text-center">
          <i class="pi pi-exclamation-circle text-4xl text-blue-500"></i>
          <h3 class="mt-2">Incidencias Abiertas</h3>
          <p class="text-3xl font-bold">{{ metrics?.openIncidents || 0 }}</p>
        </div>
      </p-card>
    </div>
    
    <div class="col-12 md:col-6 lg:col-3">
      <p-card>
        <div class="text-center">
          <i class="pi pi-check-circle text-4xl text-green-500"></i>
          <h3 class="mt-2">Incidencias Cerradas</h3>
          <p class="text-3xl font-bold">{{ metrics?.closedIncidents || 0 }}</p>
        </div>
      </p-card>
    </div>
    
    <div class="col-12 md:col-6 lg:col-3">
      <p-card>
        <div class="text-center">
          <i class="pi pi-sync text-4xl text-orange-500"></i>
          <h3 class="mt-2">En Progreso</h3>
          <p class="text-3xl font-bold">{{ metrics?.inProgressIncidents || 0 }}</p>
        </div>
      </p-card>
    </div>
    
    <div class="col-12 md:col-6 lg:col-3">
      <p-card>
        <div class="text-center">
          <i class="pi pi-clock text-4xl text-purple-500"></i>
          <h3 class="mt-2">MTTR (horas)</h3>
          <p class="text-3xl font-bold">{{ metrics?.mttr || 0 }}</p>
          <small class="text-gray-500">RF4.3: Tiempo Medio de Resolución</small>
        </div>
      </p-card>
    </div>
  </div>

  <!-- RF4.1: Charts by Status, Priority, and Severity -->
  <div class="grid mt-4">
    <div class="col-12 lg:col-4">
      <p-card header="RF4.1: Incidencias por Estado">
        <p-chart type="doughnut" [data]="statusChartData" [options]="chartOptions" height="300px"></p-chart>
      </p-card>
    </div>
    
    <div class="col-12 lg:col-4">
      <p-card header="RF4.1: Incidencias por Prioridad">
        <p-chart type="pie" [data]="priorityChartData" [options]="chartOptions" height="300px"></p-chart>
      </p-card>
    </div>
    
    <div class="col-12 lg:col-4">
      <p-card header="RF4.1: Incidencias por Severidad">
        <p-chart type="polarArea" [data]="severityChartData" [options]="chartOptions" height="300px"></p-chart>
      </p-card>
    </div>
  </div>

  <!-- RF4.4: Incident Evolution Chart -->
  <div class="grid mt-4">
    <div class="col-12">
      <p-card header="RF4.4: Evolución de Incidencias (Últimos 30 días)">
        <p-chart type="line" [data]="evolutionChartData" [options]="chartOptions" height="300px"></p-chart>
      </p-card>
    </div>
  </div>

  <!-- RF4.2: Incidents by Sprint Table -->
  <div class="grid mt-4">
    <div class="col-12">
      <p-card header="RF4.2: Incidencias por Sprint">
        <p-table [value]="metrics?.incidentsBySprint || []" [loading]="loading">
          <ng-template pTemplate="header">
            <tr>
              <th>Sprint</th>
              <th>Abiertas</th>
              <th>Cerradas</th>
              <th>Total</th>
              <th>Progreso</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-sprint>
            <tr>
              <td>{{ sprint.sprintName }}</td>
              <td>
                <span class="badge bg-blue-500 text-white px-2 py-1 rounded">{{ sprint.openCount }}</span>
              </td>
              <td>
                <span class="badge bg-green-500 text-white px-2 py-1 rounded">{{ sprint.closedCount }}</span>
              </td>
              <td>{{ sprint.totalCount }}</td>
              <td>
                <div class="w-full bg-gray-200 rounded-full h-2.5">
                  <div class="bg-green-600 h-2.5 rounded-full" 
                       [style.width.%]="sprint.totalCount > 0 ? (sprint.closedCount / sprint.totalCount * 100) : 0">
                  </div>
                </div>
                <small class="text-gray-600">
                  {{ sprint.totalCount > 0 ? ((sprint.closedCount / sprint.totalCount * 100) | number:'1.0-0') : 0 }}%
                </small>
              </td>
            </tr>
          </ng-template>
          <ng-template pTemplate="emptymessage">
            <tr>
              <td colspan="5" class="text-center">No hay datos de sprints disponibles</td>
            </tr>
          </ng-template>
        </p-table>
      </p-card>
    </div>
  </div>
</div>
