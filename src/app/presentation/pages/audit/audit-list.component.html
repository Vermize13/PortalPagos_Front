<div class="container-fluid p-4">
  <p-card>
    <div class="flex justify-content-between align-items-center mb-4">
      <h2 class="m-0">Auditoría del Sistema</h2>
      <p-button label="Exportar" icon="pi pi-download" (onClick)="onExport()" [disabled]="loading"></p-button>
    </div>

    <!-- RF5.2: Filter Section -->
    <div class="grid mb-4 p-3 bg-gray-50 border-round">
      <div class="col-12">
        <h4 class="mb-3">RF5.2: Filtros de Auditoría</h4>
      </div>
      <div class="col-12 md:col-3">
        <label class="block mb-2 font-semibold">Acción</label>
        <p-dropdown 
          [(ngModel)]="selectedAction" 
          [options]="actionOptions" 
          optionLabel="label" 
          optionValue="value"
          placeholder="Todas las acciones"
          [showClear]="true"
          styleClass="w-full">
        </p-dropdown>
      </div>
      <div class="col-12 md:col-3">
        <label class="block mb-2 font-semibold">Fecha Inicio</label>
        <p-calendar 
          [(ngModel)]="startDate" 
          [showIcon]="true" 
          placeholder="Seleccionar fecha"
          dateFormat="dd/mm/yy"
          [showButtonBar]="true"
          styleClass="w-full">
        </p-calendar>
      </div>
      <div class="col-12 md:col-3">
        <label class="block mb-2 font-semibold">Fecha Fin</label>
        <p-calendar 
          [(ngModel)]="endDate" 
          [showIcon]="true" 
          placeholder="Seleccionar fecha"
          dateFormat="dd/mm/yy"
          [showButtonBar]="true"
          styleClass="w-full">
        </p-calendar>
      </div>
      <div class="col-12 md:col-3 flex align-items-end">
        <p-button 
          label="Aplicar Filtros" 
          icon="pi pi-filter" 
          (onClick)="applyFilters()"
          styleClass="mr-2">
        </p-button>
        <p-button 
          label="Limpiar" 
          icon="pi pi-filter-slash" 
          (onClick)="clearFilters()"
          [outlined]="true">
        </p-button>
      </div>
    </div>

    <p-table 
      [value]="auditLogs" 
      [loading]="loading"
      [paginator]="true" 
      [rows]="20"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} registros"
      [rowsPerPageOptions]="[20, 50, 100]"
      styleClass="p-datatable-striped">
      
      <ng-template pTemplate="header">
        <tr>
          <th>Fecha/Hora</th>
          <th>Usuario</th>
          <th>Acción</th>
          <th>Entidad</th>
          <th>Detalles</th>
        </tr>
      </ng-template>
      
      <ng-template pTemplate="body" let-log>
        <tr>
          <td>{{ log.createdAt | date:'short' }}</td>
          <td>
            <div class="font-semibold">{{ log.userName }}</div>
            <div class="text-sm text-gray-500">{{ log.userEmail }}</div>
          </td>
          <td>
            <p-tag [value]="getActionLabel(log.action)" [severity]="getActionSeverity(log.action)"></p-tag>
          </td>
          <td>{{ log.entityName || '-' }}</td>
          <td>{{ log.detailsJson || '-' }}</td>
        </tr>
      </ng-template>
      
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="5" class="text-center">No se encontraron registros de auditoría.</td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>
</div>
