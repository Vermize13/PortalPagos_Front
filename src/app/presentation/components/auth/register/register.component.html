<div class="register-container">
  <div class="register-left">
    <div class="welcome-message">
      <h1>Completa tu Registro</h1>
      <p>Has sido invitado a unirte al sistema. Crea tu cuenta para comenzar.</p>
    </div>
  </div>
  
  <div class="register-right">
    <!-- Loading state while validating token -->
    <div class="register-card" *ngIf="validating">
      <div class="text-center">
        <p-progressSpinner [style]="{width: '50px', height: '50px'}"></p-progressSpinner>
        <p class="mt-3">Validando invitación...</p>
      </div>
    </div>

    <!-- Invalid invitation state -->
    <div class="register-card" *ngIf="!validating && !invitationValid">
      <div class="text-center">
        <i class="pi pi-exclamation-triangle" style="font-size: 3rem; color: #f59e0b;"></i>
        <h2 class="mt-3">Invitación Inválida</h2>
        <p class="text-secondary">{{ invitationMessage }}</p>
        <a routerLink="/login" class="login-link">
          <button pButton label="Ir a Iniciar Sesión" class="mt-4 p-button-outlined"></button>
        </a>
      </div>
    </div>

    <!-- Valid invitation - Registration form -->
    <div class="register-card" *ngIf="!validating && invitationValid">
      <div class="text-center mb-4">
        <h2>Crear Cuenta</h2>
      </div>

      <!-- Invitation details -->
      <div class="invitation-info mb-4">
        <div class="info-item">
          <i class="pi pi-user"></i>
          <span>{{ invitationFullName }}</span>
        </div>
        <div class="info-item">
          <i class="pi pi-envelope"></i>
          <span>{{ invitationEmail }}</span>
        </div>
        <div class="info-item">
          <i class="pi pi-id-card"></i>
          <span>{{ invitationRoleName }}</span>
        </div>
      </div>

      <form (ngSubmit)="onSubmit()" #registerForm="ngForm" class="register-form">
        <div class="field">
          <span class="p-float-label">
            <input 
              id="username"
              type="text" 
              pInputText 
              [(ngModel)]="username" 
              name="username"
              #usernameField="ngModel"
              class="w-full" 
              required
              [disabled]="loading"
            >
            <label for="username">Nombre de Usuario</label>
          </span>
          <small class="p-error" *ngIf="usernameField.invalid && (usernameField.dirty || usernameField.touched || submitted)">
            El nombre de usuario es requerido
          </small>
        </div>

        <div class="field">
          <span class="p-float-label">
            <p-password 
              id="password"
              [(ngModel)]="password" 
              name="password"
              #passwordField="ngModel"
              [feedback]="true" 
              [toggleMask]="true"
              [style]="{'width': '100%'}"
              required
              [disabled]="loading"
              promptLabel="Ingresa una contraseña"
              weakLabel="Débil"
              mediumLabel="Media"
              strongLabel="Fuerte"
            ></p-password>
            <label for="password">Contraseña</label>
          </span>
          <small class="p-error" *ngIf="passwordField.invalid && (passwordField.dirty || passwordField.touched || submitted)">
            La contraseña es requerida (mínimo 6 caracteres)
          </small>
        </div>

        <div class="field">
          <span class="p-float-label">
            <p-password 
              id="confirmPassword"
              [(ngModel)]="confirmPassword" 
              name="confirmPassword"
              #confirmPasswordField="ngModel"
              [feedback]="false" 
              [toggleMask]="true"
              [style]="{'width': '100%'}"
              required
              [disabled]="loading"
            ></p-password>
            <label for="confirmPassword">Confirmar Contraseña</label>
          </span>
          <small class="p-error" *ngIf="confirmPasswordField.invalid && (confirmPasswordField.dirty || confirmPasswordField.touched || submitted)">
            Confirme su contraseña
          </small>
          <small class="p-error" *ngIf="password && confirmPassword && password !== confirmPassword">
            Las contraseñas no coinciden
          </small>
        </div>

        <button 
          pButton 
          type="submit" 
          label="Completar Registro" 
          class="register-button w-full" 
          [loading]="loading"
          [disabled]="!username || !password || !confirmPassword || password !== confirmPassword"
        ></button>

        <div class="text-center mt-3">
          <span class="text-secondary">¿Ya tienes una cuenta? </span>
          <a routerLink="/login" class="login-link">Iniciar Sesión</a>
        </div>
      </form>
    </div>
  </div>
  <p-toast key="global-toast" position="top-center"></p-toast>
</div>
